<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apple Maps Route</title>
    <script src="https://cdn.apple-mapkit.com/mk/5.x.x/mapkit.js"></script>
    <style>
        #map {
            width: 100%;
            height: 600px;
        }
    </style>
    <script>
        // Initialisiere MapKit JS mit deinem Token
        mapkit.init({
            authorizationCallback: function (done) {
                done("DEIN_GENERIERTER_MAPKIT_JS_TOKEN"); // Ersetze diesen Token durch deinen echten Token
            }
        });

        function showRoute() {
            // URL-Parameter auslesen
            const urlParams = new URLSearchParams(window.location.search);
            const start = urlParams.get('start'); // Startkoordinaten
            const end = urlParams.get('end'); // Zielkoordinaten

            // Prüfe, ob die Parameter vorhanden sind
            if (!start || !end) {
                alert("Bitte Start- und Zielkoordinaten in der URL angeben, z. B.: ?start=47.3769,8.5417&end=46.9481,7.4474");
                return;
            }

            // Konvertiere die Koordinaten in MapKit-Coordinaten
            let startCoord = new mapkit.Coordinate(...start.split(',').map(Number));
            let endCoord = new mapkit.Coordinate(...end.split(',').map(Number));

            // Initialisiere die Karte
            let map = new mapkit.Map("map", {
                showsCompass: mapkit.FeatureVisibility.Visible,
                showsScale: mapkit.FeatureVisibility.Visible,
                center: startCoord,
                region: new mapkit.CoordinateRegion(
                    startCoord,
                    new mapkit.CoordinateSpan(0.5, 0.5)
                )
            });

            // Marker für Start und Ziel setzen
            let startAnnotation = new mapkit.MarkerAnnotation(startCoord, { title: "Start" });
            let endAnnotation = new mapkit.MarkerAnnotation(endCoord, { title: "Ziel" });
            map.addAnnotations([startAnnotation, endAnnotation]);

            // Routenberechnung
            let directions = new mapkit.Directions();
            directions.route(
                { origin: startCoord, destination: endCoord },
                (error, data) => {
                    if (error) {
                        console.error("Fehler bei der Routenberechnung:", error);
                        alert("Fehler bei der Routenberechnung: " + error.message);
                        return;
                    }

                    // Erste Route extrahieren
                    let route = data.routes[0];

                    // Punkte aus den Steps der Route extrahieren
                    let points = [];
                    for (let step of route.steps) {
                        points.push(...step.path);
                    }

                    // PolylineOverlay erstellen und zur Karte hinzufügen
                    let polyline = new mapkit.PolylineOverlay(points, {
                        style: new mapkit.Style({
                            lineWidth: 5,
                            strokeColor: "#007aff",
                            strokeOpacity: 0.8
                        })
                    });

                    map.addOverlay(polyline);

                    // Karte so einstellen, dass die gesamte Route sichtbar ist
                    map.showItems([polyline]);
                }
            );
        }
    </script>
</head>
<body onload="showRoute()">
    <h1>Apple Maps Route</h1>
    <div id="map"></div>
</body>
</html>
