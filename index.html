<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ihre Route</title>
    <script src="https://cdn.apple-mapkit.com/mk/5.x.x/mapkit.js"></script>
    <style>
        body {
            background-color: #2e2e2e; /* Dunkelgrau */
            color: white; /* Weißer Text */
            font-family: Arial, sans-serif;
        }
        #map {
            width: 100%;
            height: 600px;
            margin-bottom: 20px;
        }
        #info {
            padding: 10px;
            background-color: #3a3a3a; /* Etwas helleres Grau */
            border: 1px solid #555;
        }
        select {
            margin-bottom: 20px;
            padding: 5px;
            font-size: 16px;
        }
    </style>
    <script>
        let language = 'de'; // Standard: Deutsch

        // Sprache ändern und Seite aktualisieren
        function setLanguage(lang) {
            language = lang;
            document.body.setAttribute('lang', lang);
            updateTitle(); // Aktualisiere den Titel dynamisch
            showRoute(); // Route neu rendern
        }

        // Dynamischer Titel basierend auf Sprache und Route
        function updateTitle(start = "", end = "") {
            const title = language === 'de'
                ? start && end ? `Ihre Route von ${start} bis ${end}` : "Ihre Route"
                : start && end ? `Your Route from ${start} to ${end}` : "Your Route";
            document.title = title;
            document.getElementById("title").innerText = title;
        }

        // Zeitformatierung in Stunden und Minuten
        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.round((seconds % 3600) / 60);
            return hours > 0 ? `${hours} h ${minutes} min` : `${minutes} min`;
        }

        function showRoute() {
            const urlParams = new URLSearchParams(window.location.search);
            const start = urlParams.get('start');
            const end = urlParams.get('end');

            if (!start || !end) {
                alert(language === 'de' ? "Bitte Start- und Zielkoordinaten angeben." : "Please provide start and end coordinates.");
                return;
            }

            updateTitle(start, end); // Aktualisiere den Titel basierend auf Route

            let startCoord = new mapkit.Coordinate(...start.split(',').map(Number));
            let endCoord = new mapkit.Coordinate(...end.split(',').map(Number));

            // Initialisiere die Karte
            let map = new mapkit.Map("map", {
                showsCompass: mapkit.FeatureVisibility.Visible,
                showsScale: mapkit.FeatureVisibility.Visible,
                colorScheme: window.matchMedia('(prefers-color-scheme: dark)').matches ? mapkit.Map.ColorSchemes.Dark : mapkit.Map.ColorSchemes.Light,
                center: startCoord,
                region: new mapkit.CoordinateRegion(
                    startCoord,
                    new mapkit.CoordinateSpan(0.5, 0.5)
                )
            });

            // Marker hinzufügen
            let startAnnotation = new mapkit.MarkerAnnotation(startCoord, { title: language === 'de' ? "Start" : "Start" });
            let endAnnotation = new mapkit.MarkerAnnotation(endCoord, { title: language === 'de' ? "Ziel" : "Destination" });
            map.addAnnotations([startAnnotation, endAnnotation]);

            // Route berechnen
            let directions = new mapkit.Directions();
            directions.route(
                {
                    origin: startCoord,
                    destination: endCoord,
                    transportType: mapkit.Directions.Transport.Automobile
                },
                (error, data) => {
                    if (error) {
                        console.error("Fehler bei der Routenberechnung:", error);
                        alert(language === 'de' ? "Fehler bei der Routenberechnung." : "Error calculating the route.");
                        return;
                    }

                    let route = data.routes[0];
                    let points = [];
                    for (let step of route.steps) {
                        points.push(...step.path);
                    }

                    let polyline = new mapkit.PolylineOverlay(points, {
                        style: new mapkit.Style({
                            lineWidth: 5,
                            strokeColor: "#007aff",
                            strokeOpacity: 0.8
                        })
                    });

                    map.addOverlay(polyline);
                    map.showItems([polyline]);

                    // Routeninformationen anzeigen
                    const infoDiv = document.getElementById("info");
                    const distanceInKm = (route.distance / 1000).toFixed(2);
                    const travelTime = formatTime(route.expectedTravelTime);

                    const appleMapsLink = `https://maps.apple.com/?saddr=${start}&daddr=${end}`;
                    let routeDetails = `
                        <p><strong>${language === 'de' ? "Entfernung" : "Distance"}:</strong> ${distanceInKm} km</p>
                        <p><strong>${language === 'de' ? "Reisezeit" : "Travel Time"}:</strong> ${travelTime}</p>
                        <p><strong>${language === 'de' ? "Routenführung" : "Route Instructions"}:</strong></p>
                        <ul>
                    `;

                    for (let step of route.steps) {
                        routeDetails += `<li>${step.instructions}</li>`;
                    }
                    routeDetails += `</ul>`;
                    routeDetails += `<p><a href="${appleMapsLink}" target="_blank">${language === 'de' ? "Route in Apple Maps öffnen" : "Open route in Apple Maps"}</a></p>`;
                    infoDiv.innerHTML = routeDetails;
                }
            );
        }
    </script>
</head>
<body>
    <select onchange="setLanguage(this.value)">
        <option value="de" selected>Deutsch</option>
        <option value="en">English</option>
    </select>
    <h1 id="title">Ihre Route</h1>
    <div id="map"></div>
    <div id="info"></div>
    <script>
        showRoute(); // Initialer Aufruf der Funktion
    </script>
</body>
</html>
